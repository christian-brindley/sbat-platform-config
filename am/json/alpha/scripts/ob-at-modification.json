{
  "name": "Open Banking AT Modification Script",
  "script": "dmFyIGNvbmZpZyA9IHsKICByZWFsbTogImFscGhhIiwKICBjbGllbnRJZDogImF0bVNjcmlwdCIsCiAgY2xpZW50U2VjcmV0OiAicGFzc3dvcmQiLAogIHRydXN0ZWRHYXRld2F5U2NvcGU6ICJ0cnVzdGVkX2dhdGV3YXkiCn07CgoKdmFyIGZyID0gSmF2YUltcG9ydGVyKAogICAgb3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5leGNlcHRpb25zLkludmFsaWRSZXF1ZXN0RXhjZXB0aW9uCik7CgoKCmZ1bmN0aW9uIHRhZyhtZXNzYWdlKSB7CiAgICByZXR1cm4gIioqKiIuY29uY2F0KHNjcmlwdE5hbWUpLmNvbmNhdCgiICIpLmNvbmNhdChtZXNzYWdlKTsKfQoKZnVuY3Rpb24gdmFsaWRhdGVUb2tlbih0b2tlbikgewogIAogICAgY29uc3QgcmVxdWVzdEJvZHkgPSAiY2xpZW50X2lkPSIuY29uY2F0KGNvbmZpZy5jbGllbnRJZCkKICAgICAgICAgICAgICAgICAgICAgICAgLmNvbmNhdCgiJmNsaWVudF9zZWNyZXQ9IikuY29uY2F0KGNvbmZpZy5jbGllbnRTZWNyZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIC5jb25jYXQoIiZ0b2tlbj0iKS5jb25jYXQodG9rZW4pOwogIAogICAgY29uc3QgdXJpID0gImh0dHA6Ly9hbS9hbS9vYXV0aDIvcmVhbG1zL3Jvb3QvcmVhbG1zLyIuY29uY2F0KGNvbmZpZy5yZWFsbSkKICAgICAgICAgICAgICAgIC5jb25jYXQoIi9pbnRyb3NwZWN0Iik7CiAgCiAgICBsb2dnZXIubWVzc2FnZSh0YWcoIkNoZWNraW5nIHRva2VuIGF0ICIgKyB1cmkpKTsKICAgIGxvZ2dlci5tZXNzYWdlKHRhZygiUmVxdWVzdCBib2R5ICIgKyByZXF1ZXN0Qm9keSkpOwogICAgdmFyIHJlc3BvbnNlOwoKICAgIHRyeSB7CiAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgb3JnLmZvcmdlcm9jay5odHRwLnByb3RvY29sLlJlcXVlc3QoKTsKICAgICAgICByZXF1ZXN0LnNldE1ldGhvZCgiUE9TVCIpOwogICAgICAgIHJlcXVlc3Quc2V0VXJpKHVyaSk7CiAgICAgICAgcmVxdWVzdC5nZXRIZWFkZXJzKCkuYWRkKCJDb250ZW50LVR5cGUiLCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsKICAgICAgICByZXF1ZXN0LmdldEVudGl0eSgpLnNldFN0cmluZyhyZXF1ZXN0Qm9keSk7CgogICAgICAgIHJlc3BvbnNlID0gaHR0cENsaWVudC5zZW5kKHJlcXVlc3QpLmdldCgpOwogICAgfQogICAgY2F0Y2ggKGUpIHsKICAgICAgICBsb2dnZXIuZXJyb3IodGFnKCJFeGNlcHRpb24gY2FsbGluZyBpbnN0cm9zcGVjdCBlbmRwb2ludCAiICsgZSkpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgcmVzcG9uc2VCb2R5ID0gcmVzcG9uc2UuZ2V0RW50aXR5KCkuZ2V0U3RyaW5nKCk7CiAgICBsb2dnZXIubWVzc2FnZSh0YWcoIkdvdCByYXcgcmVzcG9uc2UgIiArIHJlc3BvbnNlQm9keSkpOwogICAgdmFyIHJlc3BvbnNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VCb2R5KTsKICAKICAgIGxvZ2dlci5tZXNzYWdlKHRhZygiR290IHJlc3BvbnNlICIgKyByZXNwb25zZURhdGEpKTsKICAKICAgIHJldHVybiAocmVzcG9uc2VEYXRhLmFjdGl2ZSAmJiAKICAgICAgICAgICAgcmVzcG9uc2VEYXRhLnNjb3BlICYmIAogICAgICAgICAgICAocmVzcG9uc2VEYXRhLnNjb3BlLnRvU3RyaW5nKCkuc3BsaXQoIiAiKS5pbmRleE9mKGNvbmZpZy50cnVzdGVkR2F0ZXdheVNjb3BlKSAhPT0gLTEpKTsKfQoKbG9nZ2VyLm1lc3NhZ2UodGFnKCJTdGFydGluZyIpKTsKCmxvZ2dlci5tZXNzYWdlKHRhZygiU2NvcGVzIGFyZSAiICsgc2NvcGVzKSk7CnNjb3Blcy50b0FycmF5KCkuZm9yRWFjaChmdW5jdGlvbiAoc2NvcGUpIHsKICBsb2dnZXIubWVzc2FnZSh0YWcoc2NvcGUpKTsKfSkKCnZhciBzY29wZXNTdHJpbmcgPSAiIi5jb25jYXQoc2NvcGVzKTsKCmlmIChzY29wZXNTdHJpbmcuaW5kZXhPZigiYWNjb3VudHMiKSAhPT0gLTEpIHsKICBsb2dnZXIubWVzc2FnZSh0YWcoIkVuZm9yY2luZyBhY2Nlc3MgdG9rZW4iKSk7CiAgbG9nZ2VyLm1lc3NhZ2UodGFnKCJSZXF1ZXN0IHByb3BlcnRpZXMgIiArIHJlcXVlc3RQcm9wZXJ0aWVzKSk7CiAgdmFyIGFjY2Vzc1Rva2VucyA9IHJlcXVlc3RQcm9wZXJ0aWVzLmdldCgicmVxdWVzdFBhcmFtcyIpLmdldCgiZ2F0ZXdheV9hdXRob3JpemF0aW9uIik7CiAgaWYgKCFhY2Nlc3NUb2tlbnMpIHsKICAgIGxvZ2dlci5lcnJvcih0YWcoIk5vIGdhdGV3YXkgYXV0aHogdG9rZW4gcGFyYW1ldGVyIikpOwogICAgLy8gdGhyb3cgIkF1dGhvcml6YXRpb24gZXJyb3IgLSBubyBhdXRoeiB0b2tlbiBwYXJhbWV0ZXIiOwogICAgdGhyb3cgbmV3IGZyLkludmFsaWRSZXF1ZXN0RXhjZXB0aW9uKCJObyBnYXRld2F5IGF1dGh6IHRva2VuIHBhcmFtZXRlciIpOwogIH0KICAKICB2YXIgYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbnMuZ2V0KDApOwogIGlmICghYWNjZXNzVG9rZW4pIHsKICAgIGxvZ2dlci5lcnJvcih0YWcoIk5vIGdhdGV3YXkgYXV0aHogdG9rZW4iKSk7CiAgICAvLyB0aHJvdyAiQXV0aG9yaXphdGlvbiBlcnJvciAtIG5vIHRva2VuIjsKICAgIHRocm93IHsKICAgICAgY29kZSA6IDQwMSwKICAgICAgbWVzc2FnZSA6ICJFcnJvciIsCiAgICAgIGRldGFpbDogewogICAgICAgICBjb2RlOiAiNDAxIiwKICAgICAgICAgZGVzY3JpcHRpb24gOiAiQXV0aG9yaXphdGlvbiBlcnJvciAtIG5vIHRva2VuIiwgCiAgICAgICAgIHNldmVyaXR5IDogIkZhdGFsIgogICAgIH0KICAgIH0KICB9CiAgCiAgbG9nZ2VyLm1lc3NhZ2UodGFnKCJHb3QgYWNjZXNzIHRva2VuICIgKyBhY2Nlc3NUb2tlbikpOwoKICBpZiAoIXZhbGlkYXRlVG9rZW4oYWNjZXNzVG9rZW4pKSB7CiAgICBsb2dnZXIuZXJyb3IodGFnKCJObyBnYXRld2F5IGF1dGh6IHRva2VuIikpOwogICAgdGhyb3cgIkF1dGhvcml6YXRpb24gZXJyb3IgLSBpbnRyb3NwZWN0IGZhaWxlZCI7CiAgfQogIAp9",
  "language": "JAVASCRIPT",
  "context": "OAUTH2_ACCESS_TOKEN_MODIFICATION",
  "description": "",
  "default": false,
  "createdBy": "null",
  "creationDate": 0,
  "lastModifiedBy": "null",
  "lastModifiedDate": 0
}
